# SWITCH 节点使用说明

SWITCH 节点用于实现条件分支逻辑，根据表达式的评估结果选择不同的执行路径，是工作流中实现决策和路由的核心组件。

## 基本功能

- 根据条件表达式动态选择执行路径
- 支持多个条件分支和默认分支
- 提供两种评估模式：值比较和表达式匹配
- 灵活处理复杂的业务逻辑判断

## 配置说明

### 基本属性

- **表达式**: 要评估的表达式或变量，支持使用`#{}`引用工作流变量
  - 例如: `#{payload.status}` 或 `#{user.type}`
  - 可以是简单变量引用、复杂对象属性或计算表达式

- **条件评估模式**: 选择表达式的处理方式
  - **值比较**: 将表达式的值与各分支条件进行比较
    - 例如表达式为`#{status}`，分支条件为`"active"`，则比较status变量的值是否等于"active"
  - **表达式匹配**: 将各分支条件作为表达式求值，结果为true时匹配该分支
    - 例如表达式为`#{amount}`，分支条件为`> 1000`，则evaluationMode表达式为`#{amount > 1000}`

- **分支条件列表**: 定义多个条件分支
  - 每个分支包含：
    - 条件: 要匹配的条件值或表达式
    - 目标: 连接的目标节点(通过界面连线设置)

### 异常处理

- **错误处理策略**:
  - **终止流程**: 出错时停止整个流程
  - **忽略错误**: 出错时继续，使用默认返回值
  - **使用默认分支**: 出错时执行默认分支

- **超时时间(毫秒)**: 条件评估的最长等待时间
- **失败返回值**: 条件评估失败时返回的默认JSON数据

## 使用指南

### 创建分支条件

1. 在属性面板中设置表达式和评估模式
2. 点击节点右下角的"+"按钮添加分支条件
3. 输入条件值或表达式
4. 从分支条件右侧的连接点拖出连线，连接到目标节点
5. 默认分支无需设置条件，会在所有条件都不满足时执行

### 分支条件示例

#### 值比较模式
表达式: `#{order.status}`

分支条件:
- "pending" → 连接到"处理待付款"节点
- "paid" → 连接到"处理已付款"节点
- "cancelled" → 连接到"处理已取消"节点
- 默认分支 → 连接到"处理未知状态"节点

#### 表达式匹配模式
表达式: `#{order.amount}`

分支条件:
- "< 100" → 连接到"小额订单处理"节点
- ">= 100 && < 1000" → 连接到"中额订单处理"节点
- ">= 1000" → 连接到"大额订单处理"节点
- 默认分支 → 连接到"异常订单处理"节点

## 最佳实践

1. **使用有意义的分支命名**
   - 分支条件应当清晰表达判断含义
   - 例如使用 "is_premium_user" 而不是简单的 "true"

2. **设计合理的分支顺序**
   - 从特殊情况到一般情况排序
   - 优先判断更常见的情况可提高效率

3. **使用默认分支处理意外情况**
   - 始终连接默认分支，作为兜底处理
   - 在默认分支中添加日志或警告

4. **简化复杂判断**
   - 对于非常复杂的条件，可以在前置节点中使用脚本节点预处理
   - 例如：使用脚本计算出 `eligibilityFlag`，然后在SWITCH节点中直接判断该标志

5. **嵌套分支处理多维度判断**
   - 多个SWITCH节点可以串联，形成决策树
   - 例如：第一个分支判断用户类型，第二个分支判断订单金额

## 注意事项

- 确保表达式引用的变量存在，否则会导致评估错误
- 条件评估时按照添加顺序依次判断，第一个匹配的条件将被执行
- 未连接的分支会被忽略，即使条件满足也不会执行
- 在表达式匹配模式下，条件必须是有效的表达式片段
- 分支过多会降低工作流的可读性，考虑拆分为多个SWITCH节点
- 循环依赖(分支指向自身或上游节点)可能导致无限循环，请谨慎设计
- 过于复杂的表达式可能影响可维护性，建议在必要时使用脚本节点预处理数据