# REDIS 节点使用说明

REDIS 节点用于与Redis缓存服务器交互，支持多种数据类型和操作命令，适用于缓存管理、计数器、分布式锁等场景。

## 基本功能

- 连接到Redis服务器
- 支持所有主要Redis数据类型操作
- 执行键值对读写、列表操作、集合管理等
- 管理数据过期时间
- 执行原子性操作

## 配置说明

### 连接设置

- **主机地址**: Redis服务器地址
  - 本地Redis可使用`localhost`
  - 远程Redis填写服务器IP或域名

- **端口**: Redis服务器端口号
  - 默认: 6379

- **密码**: Redis服务器密码(如不需要可留空)

- **数据库索引**: Redis数据库索引(0-15)
  - 默认: 0

### 操作配置

- **数据类型**: 选择要操作的Redis数据类型
  - 字符串 (String): 单个键值存储
  - 哈希表 (Hash): 存储对象结构
  - 列表 (List): 有序元素集合
  - 集合 (Set): 无序不重复元素集合
  - 有序集合 (Sorted Set): 带分数的有序集合
  - 位图 (Bitmap): 位操作
  - 基数统计 (HyperLogLog): 估算集合基数
  - 键操作 (Key): 通用键管理

- **操作命令**: 根据所选数据类型提供不同的操作命令
  - 字符串: GET, SET, MGET, MSET, SETEX等
  - 哈希表: HGET, HSET, HMGET, HMSET, HDEL等
  - 列表: LPUSH, RPUSH, LPOP, RPOP, LRANGE等
  - 集合: SADD, SREM, SMEMBERS, SCARD等
  - 有序集合: ZADD, ZREM, ZRANGE, ZRANGEBYSCORE等
  - 位图: SETBIT, GETBIT, BITCOUNT等
  - 基数统计: PFADD, PFCOUNT, PFMERGE
  - 键操作: DEL, UNLINK, EXPIRE, TTL, EXISTS等

- **键名**: 操作的键名称，支持`#{变量}`引用工作流变量

- **其他参数**: 根据所选操作命令提供的其他必要参数
  - 字段名: 用于哈希表操作
  - 值: 用于设置操作
  - 过期时间: 用于SETEX等带过期时间的操作
  - 成员: 用于集合操作
  - 分数: 用于有序集合操作
  - 偏移量: 用于位图操作

### 异常处理

- **错误处理策略**:
  - 终止流程: 出错时停止整个流程
  - 忽略错误: 出错时继续，使用默认返回值
  - 重试执行: 出错时尝试重新执行操作

- **超时时间(毫秒)**: Redis操作的最长等待时间
- **最大重试次数**: 选择重试策略时的重试次数
- **重试间隔(毫秒)**: 两次重试之间的等待时间
- **启用指数退避**: 每次重试等待时间增加
- **失败返回值**: 操作失败时返回的默认JSON数据

## 最佳实践

1. **使用合理的键命名规范**
   - 使用冒号分隔的命名空间: `app:user:123:profile`
   - 避免过长的键名，增加内存占用

2. **设置合适的过期时间**
   - 使用SETEX而不是SET，为键值设置过期时间
   - 避免缓存数据永久存在导致内存不足

3. **利用Redis数据类型的特性**
   - 使用Hash存储对象数据，比多个String更节省空间
   - 使用List实现队列或最近N条记录
   - 使用Set实现标签系统
   - 使用Sorted Set实现排行榜

4. **原子操作优化**
   - 使用INCR/INCRBY等原子操作，而不是GET后SET
   - 使用HINCRBY增加哈希表中的计数器值

5. **批量操作提高效率**
   - 使用MGET/MSET批量读写多个键
   - 使用HMGET/HMSET批量操作哈希表字段

6. **使用Redis实现分布式锁**
   ```
   // 获取锁
   SET lock:resource_name #{randomValue} NX PX 30000
   
   // 执行操作...
   
   // 释放锁(使用Lua脚本确保原子性)
   if redis.call("get", KEYS[1]) == ARGV[1] then
     return redis.call("del", KEYS[1])
   else
     return 0
   end
   ```

## 注意事项

- Redis主要是内存数据库，注意内存使用限制
- 谨慎使用列表/集合的全量操作(LRANGE, SMEMBERS等)，大数据集可能导致性能问题
- 键的过期是尽力而为的，不要依赖精确的过期时间
- 不同Redis版本支持的命令和选项有差异，确认兼容性
- Redis单线程模型下，避免长时间运行的命令(如KEYS)导致阻塞
- 在集群环境中，键的哈希槽分布限制了跨槽的多键操作
- 对于敏感数据，确保Redis设置了访问密码和网络隔离
- 写入错误的数据类型会导致操作失败，如对String执行HGET